<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø®Ø±ÛŒØ¯ Ùˆ ØªÙ…Ø¯ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú© Ay VPN | Ay Technic</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">


    <style>
        /* FONT & BASE STYLES */
        @font-face {
            font-family: 'Vazirmatn';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/fonts/webfonts/Vazirmatn-Bold.woff2') format('woff2');
            font-weight: 700;
            font-display: swap;
        }
        @font-face {
            font-family: 'Vazirmatn';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/fonts/webfonts/Vazirmatn-Medium.woff2') format('woff2');
            font-weight: 500;
            font-display: swap;
        }
        @font-face {
            font-family: 'Vazirmatn';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/fonts/webfonts/Vazirmatn-Regular.woff2') format('woff2');
            font-weight: 400;
            font-display: swap;
        }
        :root {
            --font-family: 'Vazirmatn', sans-serif;
            --transition-speed: 0.3s;
            --primary-color: #007bff; /* Blue */
            --secondary-color: #6c757d; /* Gray */
            --success-color: #28a745; /* Green */
            --danger-color: #dc3545; /* Red */
            --warning-color: #ffc107; /* Yellow */
            --bg-light: #f8f9fa;
            --bg-white: #ffffff;
            --text-dark: #212529;
            --border-color: #dee2e6;
            --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            --shadow-lg: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            --plan-color: #007bff; /* Default for selected plan */
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-light);
            color: var(--text-dark);
            direction: rtl;
            text-align: right;
            line-height: 1.6;
            padding-top: 50px;
            padding-bottom: 50px;
        }

        .container {
            width: 90%;
            max-width: 1000px;
            margin: 0 auto;
        }

        /* HEADER */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 5px;
        }

        .header p {
            color: var(--secondary-color);
            font-size: 1.1rem;
        }

        /* TABS */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border-color);
        }

        .tab-button {
            background-color: transparent;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: color var(--transition-speed), border-bottom-color var(--transition-speed);
            color: var(--secondary-color);
            position: relative;
            z-index: 1;
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            font-weight: 700;
        }

        /* TAB CONTENT */
        .tab-content {
            display: none;
            background-color: var(--bg-white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
        }

        .tab-content.active {
            display: block;
        }

        /* PLAN CARDS (BUY TAB) */
        .plan-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .plan-card {
            background-color: var(--bg-white);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            width: calc(33.333% - 14px);
            text-align: center;
            transition: all var(--transition-speed);
            cursor: pointer;
            position: relative;
        }

        .plan-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .plan-card.selected {
            border-color: var(--plan-color);
            box-shadow: 0 0 15px rgba(0, 123, 255, 0.5);
            transform: translateY(-5px);
        }

        .plan-card h3 {
            color: var(--primary-color);
            font-size: 1.6rem;
            margin-bottom: 10px;
        }

        .plan-card .price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 15px;
        }

        .plan-card .price small {
            font-size: 1rem;
            font-weight: 500;
            color: var(--secondary-color);
        }

        .plan-card .feature-list {
            list-style: none;
            text-align: right;
            margin-bottom: 20px;
        }

        .plan-card .feature-list li {
            padding: 5px 0;
            font-size: 1rem;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }

        .plan-card .feature-list li svg {
            color: var(--success-color);
            margin-left: 10px;
        }
        
        /* DYNAMIC SECTION (Users/Coupon/Summary) */
        .dynamic-section {
            margin-top: 30px;
            padding: 20px;
            border: 1px dashed var(--border-color);
            border-radius: 8px;
            background-color: #f0f8ff; /* Light Blue BG */
            display: none; /* Initially hidden */
        }
        
        .dynamic-section h4 {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        /* FORM STYLES */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: var(--font-family);
            font-size: 1rem;
        }
        
        .form-group select {
            cursor: pointer;
        }
        
        .coupon-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .coupon-group input {
            flex-grow: 1;
        }
        
        .coupon-group button {
            flex-shrink: 0;
            padding: 10px 20px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color var(--transition-speed);
        }
        
        .coupon-group button:hover:not(:disabled) {
            background-color: var(--primary-color);
        }
        
        /* SUMMARY BOX */
        .summary-box {
            background-color: var(--bg-white);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            margin-top: 20px;
            border: 1px solid var(--primary-color);
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dotted var(--border-color);
        }
        
        .summary-item:last-child {
            border-bottom: none;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary-color);
            padding-top: 10px;
            margin-top: 10px;
            border-top: 1px solid var(--primary-color);
        }
        
        /* ERROR/SUCCESS MESSAGES */
        .coupon-message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-weight: 500;
            display: none;
        }

        .coupon-error {
            background-color: #f8d7da;
            color: var(--danger-color);
            border: 1px solid #f5c6cb;
        }

        .coupon-success {
            background-color: #d4edda;
            color: var(--success-color);
            border: 1px solid #c3e6cb;
        }

        /* BUTTONS */
        .btn-primary {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 20px;
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            border: none;
            border-radius: 4px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color var(--transition-speed);
        }
        
        .btn-primary:hover:not(:disabled) {
            background-color: #0056b3;
        }
        
        .btn-primary:disabled {
            background-color: #a0c3e7;
            cursor: not-allowed;
        }

        /* TRACKING TAB */
        #tracking-form {
            max-width: 500px;
            margin: 0 auto;
            text-align: center;
        }
        
        .tracking-results {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: var(--bg-white);
            box-shadow: var(--shadow-sm);
        }
        
        .result-item {
            border-bottom: 1px solid var(--border-color);
            padding: 10px 0;
            text-align: right;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-item strong {
            font-weight: 700;
            margin-left: 5px;
        }
        
        .result-item a {
            word-break: break-all;
        }


        /* RENEW TAB */
        #renewal-form {
             max-width: 500px;
            margin: 0 auto;
            text-align: center;
        }
        
        .plan-selection-renew {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        /* FOOTER */
        .footer {
            text-align: center;
            padding-top: 40px;
            margin-top: 40px;
            border-top: 1px solid var(--border-color);
            color: var(--secondary-color);
            font-size: 0.9rem;
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .plan-card {
                width: calc(50% - 10px);
            }
            .header h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 576px) {
            .plan-card {
                width: 100%;
            }
            .tab-button {
                padding: 10px 15px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        
        <header class="header">
            <h1>Ø®Ø±ÛŒØ¯ Ùˆ ØªÙ…Ø¯ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú© Ay VPN</h1>
            <p>Ø³Ø±ÙˆÛŒØ³ Ù¾Ø±Ø³Ø±Ø¹Øª Ùˆ Ø§Ù…Ù† Ø¨Ø±Ø§ÛŒ Ø¹Ø¨ÙˆØ± Ø§Ø² ÙÛŒÙ„ØªØ±ÛŒÙ†Ú¯ | Ø§Ø±Ø§Ø¦Ù‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ay Technic</p>
        </header>

        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'buy-tab')">ğŸ›’ Ø®Ø±ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú©</button>
            <button class="tab-button" onclick="openTab(event, 'renew-tab')">ğŸ”„ ØªÙ…Ø¯ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú©</button>
            <button class="tab-button" onclick="openTab(event, 'track-tab')">ğŸ” Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´</button>
        </div>

        <div id="buy-tab" class="tab-content active">
            
            <h4>Û±. Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ù„Ù†</h4>
            <div class="plan-cards">
                <div class="plan-card" data-plan-code="1M" data-base-amount="1200000" data-duration="1 Ù…Ø§Ù‡Ù‡" onclick="selectPlan(this)">
                    <h3>ğŸ’ Û± Ù…Ø§Ù‡Ù‡</h3>
                    <div class="price">Û±Û²Û°,Û°Û°Û° <small>ØªÙˆÙ…Ø§Ù†</small></div>
                    <ul class="feature-list">
                        <li><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg> Ø§ØªØµØ§Ù„ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡</li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg> Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ Ù…ØªØ¹Ø¯Ø¯</li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg> Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Û²Û´/Û·</li>
                    </ul>
                </div>
                
                <div class="plan-card" data-plan-code="3M" data-base-amount="3400000" data-duration="Û³ Ù…Ø§Ù‡Ù‡" onclick="selectPlan(this)">
                    <h3>ğŸŒŸ Û³ Ù…Ø§Ù‡Ù‡</h3>
                    <div class="price">Û³Û´Û°,Û°Û°Û° <small>ØªÙˆÙ…Ø§Ù†</small></div>
                     <ul class="feature-list">
                        <li><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg> Ø§ØªØµØ§Ù„ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡</li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg> Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ Ù…ØªØ¹Ø¯Ø¯</li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg> Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Û²Û´/Û·</li>
                    </ul>
                </div>
                
                <div class="plan-card" data-plan-code="1Y" data-base-amount="10000000" data-duration="Û± Ø³Ø§Ù„Ù‡" onclick="selectPlan(this)">
                    <h3>ğŸ‘‘ Û± Ø³Ø§Ù„Ù‡</h3>
                    <div class="price">Û±,Û°Û°Û°,Û°Û°Û° <small>ØªÙˆÙ…Ø§Ù†</small></div>
                     <ul class="feature-list">
                        <li><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg> Ø§ØªØµØ§Ù„ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡</li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg> Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ Ù…ØªØ¹Ø¯Ø¯</li>
                        <li><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg> Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Û²Û´/Û·</li>
                    </ul>
                </div>
                
                <div class="plan-card" data-plan-code="2M" data-base-amount="2200000" data-duration="Û² Ù…Ø§Ù‡Ù‡" onclick="selectPlan(this)">
                    <h3>ğŸš€ Û² Ù…Ø§Ù‡Ù‡</h3>
                    <div class="price">Û²Û²Û°,Û°Û°Û° <small>ØªÙˆÙ…Ø§Ù†</small></div>
                    <ul class="feature-list">
                        <li>...</li>
                    </ul>
                </div>
                <div class="plan-card" data-plan-code="6M" data-base-amount="6000000" data-duration="Û¶ Ù…Ø§Ù‡Ù‡" onclick="selectPlan(this)">
                    <h3>ğŸ”¥ Û¶ Ù…Ø§Ù‡Ù‡</h3>
                    <div class="price">Û¶Û°Û°,Û°Û°Û° <small>ØªÙˆÙ…Ø§Ù†</small></div>
                    <ul class="feature-list">
                        <li>...</li>
                    </ul>
                </div>
                <div class="plan-card" data-plan-code="2Y" data-base-amount="20000000" data-duration="Û² Ø³Ø§Ù„Ù‡" onclick="selectPlan(this)">
                    <h3>â­ Û² Ø³Ø§Ù„Ù‡</h3>
                    <div class="price">Û²,Û°Û°Û°,Û°Û°Û° <small>ØªÙˆÙ…Ø§Ù†</small></div>
                    <ul class="feature-list">
                        <li>...</li>
                    </ul>
                </div>
                
            </div>
            
            <form id="purchase-form">
                <div id="dynamic-section" class="dynamic-section">
                    
                    <h4>Û². Ù…Ø´Ø®ØµØ§Øª Ø³ÙØ§Ø±Ø´</h4>

                    <div class="form-group">
                        <label for="users">ğŸ”¢ ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø± (Û± ØªØ§ Û±Û° Ù†ÙØ±):</label>
                        <select id="users" name="users" required onchange="updateSummary()">
                            <option value="1">Û± Ú©Ø§Ø±Ø¨Ø±</option>
                            <option value="2">Û² Ú©Ø§Ø±Ø¨Ø± (ÛµÛ°Ùª ØªØ®ÙÛŒÙ Ú©Ø§Ø±Ø¨Ø± Ø¯ÙˆÙ…)</option>
                            <option value="3">Û³ Ú©Ø§Ø±Ø¨Ø± (ÛµÛ°Ùª ØªØ®ÙÛŒÙ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø¹Ø¯ÛŒ)</option>
                            <option value="4">Û´ Ú©Ø§Ø±Ø¨Ø±</option>
                            <option value="5">Ûµ Ú©Ø§Ø±Ø¨Ø±</option>
                            <option value="6">Û¶ Ú©Ø§Ø±Ø¨Ø±</option>
                            <option value="7">Û· Ú©Ø§Ø±Ø¨Ø±</option>
                            <option value="8">Û¸ Ú©Ø§Ø±Ø¨Ø±</option>
                            <option value="9">Û¹ Ú©Ø§Ø±Ø¨Ø±</option>
                            <option value="10">Û±Û° Ú©Ø§Ø±Ø¨Ø±</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="coupenCode">ğŸ« Ú©Ø¯ ØªØ®ÙÛŒÙ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                        <div class="coupon-group">
                            <input type="text" id="coupenCode" name="coupenCode" placeholder="Ú©Ø¯ ØªØ®ÙÛŒÙ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" oninput="clearCouponMessage()">
                            <button type="button" id="checkCouponBtn" onclick="checkCoupon()">Ø§Ø¹Ù…Ø§Ù„</button>
                        </div>
                        <div id="couponMessage" class="coupon-message" style="display: none;"></div>
                    </div>

                    <div class="form-group">
                        <label for="email">ğŸ“§ Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ (Ø¨Ø±Ø§ÛŒ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ):</label>
                        <input type="text" id="email" name="email" placeholder="Ù…Ø«Ø§Ù„: example@gmail.com ÛŒØ§ 0912xxxxxxx" required>
                    </div>
                    
                    <input type="hidden" id="renewalIdentifier" name="renewalIdentifier" value="">
                    
                    <h4>Û³. Ø®Ù„Ø§ØµÙ‡ ÙØ§Ú©ØªÙˆØ±</h4>
                    <div class="summary-box">
                        <div class="summary-item"><span>Ù¾Ù„Ù† Ø§Ù†ØªØ®Ø§Ø¨ÛŒ:</span><span id="summary-plan">-</span></div>
                        <div class="summary-item"><span>ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†:</span><span id="summary-users">-</span></div>
                        <div class="summary-item"><span>Ù…Ø¨Ù„Øº Ù¾Ø§ÛŒÙ‡:</span><span id="summary-base-amount">-</span></div>
                        <div class="summary-item" id="summary-discount-row" style="display: none;"><span>ØªØ®ÙÛŒÙ Ú©ÙˆÙ¾Ù†:</span><span id="summary-discount-value" style="color: var(--success-color);">-</span></div>
                        <div class="summary-item"><span>Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª (ØªÙˆÙ…Ø§Ù†):</span><span id="summary-final-amount" data-final-amount="0">Û°</span></div>
                    </div>
                    
                    <button type="submit" id="payButton" class="btn-primary" disabled>
                        <i class="fa fa-shopping-cart"></i> Ø§Ø¯Ø§Ù…Ù‡ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª Û° ØªÙˆÙ…Ø§Ù†
                    </button>
                </div>
            </form>

        </div>

        <div id="renew-tab" class="tab-content">
            <form id="renewal-form">
                <h4>Û±. Ù…Ø´Ø®ØµØ§Øª ØªÙ…Ø¯ÛŒØ¯</h4>
                <div class="form-group">
                    <label for="renewId">ğŸ”„ Ø´Ù†Ø§Ø³Ù‡ Ø§Ø´ØªØ±Ø§Ú© ÛŒØ§ Ø§ÛŒÙ…ÛŒÙ„/Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ø«Ø¨Øª Ø´Ø¯Ù‡:</label>
                    <input type="text" id="renewId" name="renewId" placeholder="Ø´Ù†Ø§Ø³Ù‡ ÛŒØ§ Ù…Ø´Ø®ØµØ§Øª Ù‚Ø¨Ù„ÛŒ" required>
                </div>
                
                 <h4>Û². Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ù„Ù† ØªÙ…Ø¯ÛŒØ¯</h4>
                <div class="plan-selection-renew">
                    <div class="plan-card" data-plan-code="1M" data-base-amount="1200000" data-duration="Û± Ù…Ø§Ù‡Ù‡" onclick="selectRenewPlan(this)">
                        <h3>Û± Ù…Ø§Ù‡Ù‡</h3>
                        <div class="price">Û±Û²Û°,Û°Û°Û° <small>ØªÙˆÙ…Ø§Ù†</small></div>
                    </div>
                    <div class="plan-card" data-plan-code="3M" data-base-amount="3400000" data-duration="Û³ Ù…Ø§Ù‡Ù‡" onclick="selectRenewPlan(this)">
                         <h3>Û³ Ù…Ø§Ù‡Ù‡</h3>
                        <div class="price">Û³Û´Û°,Û°Û°Û° <small>ØªÙˆÙ…Ø§Ù†</small></div>
                    </div>
                    <div class="plan-card" data-plan-code="1Y" data-base-amount="10000000" data-duration="Û± Ø³Ø§Ù„Ù‡" onclick="selectRenewPlan(this)">
                         <h3>Û± Ø³Ø§Ù„Ù‡</h3>
                        <div class="price">Û±,Û°Û°Û°,Û°Û°Û° <small>ØªÙˆÙ…Ø§Ù†</small></div>
                    </div>
                    </div>
                
                <div id="dynamic-section-renew" class="dynamic-section" style="margin-top: 30px;">
                    <div class="form-group">
                        <label for="renew-users">ğŸ”¢ ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±:</label>
                        <select id="renew-users" name="users" required onchange="updateRenewSummary()">
                            </select>
                    </div>

                    <div class="form-group">
                        <label for="renew-coupenCode">ğŸ« Ú©Ø¯ ØªØ®ÙÛŒÙ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                        <div class="coupon-group">
                            <input type="text" id="renew-coupenCode" name="coupenCode" placeholder="Ú©Ø¯ ØªØ®ÙÛŒÙ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" oninput="clearRenewCouponMessage()">
                            <button type="button" id="checkRenewCouponBtn" onclick="checkRenewCoupon()">Ø§Ø¹Ù…Ø§Ù„</button>
                        </div>
                        <div id="renewCouponMessage" class="coupon-message" style="display: none;"></div>
                    </div>

                    
                    <h4>Û³. Ø®Ù„Ø§ØµÙ‡ ÙØ§Ú©ØªÙˆØ± ØªÙ…Ø¯ÛŒØ¯</h4>
                    <div class="summary-box">
                        <div class="summary-item"><span>Ù¾Ù„Ù† Ø§Ù†ØªØ®Ø§Ø¨ÛŒ:</span><span id="renew-summary-plan">-</span></div>
                        <div class="summary-item"><span>ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†:</span><span id="renew-summary-users">-</span></div>
                        <div class="summary-item"><span>Ù…Ø¨Ù„Øº Ù¾Ø§ÛŒÙ‡:</span><span id="renew-summary-base-amount">-</span></div>
                        <div class="summary-item" id="renew-summary-discount-row" style="display: none;"><span>ØªØ®ÙÛŒÙ Ú©ÙˆÙ¾Ù†:</span><span id="renew-summary-discount-value" style="color: var(--success-color);">-</span></div>
                        <div class="summary-item"><span>Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª (ØªÙˆÙ…Ø§Ù†):</span><span id="renew-summary-final-amount" data-final-amount="0">Û°</span></div>
                    </div>
                    
                    <button type="submit" id="renewPayButton" class="btn-primary" disabled>
                        <i class="fa fa-shopping-cart"></i> Ø§Ø¯Ø§Ù…Ù‡ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª Û° ØªÙˆÙ…Ø§Ù†
                    </button>
                </div>
            </form>
        </div>


        <div id="track-tab" class="tab-content">
            <form id="tracking-form">
                <h4>ğŸ” Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´ Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡</h4>
                <div class="form-group">
                    <label for="trackingId">Ø´Ù†Ø§Ø³Ù‡ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ (Tracking ID):</label>
                    <input type="text" id="trackingId" name="trackingId" placeholder="Ù…Ø«Ø§Ù„: xxxxxxxxxxxx" required>
                </div>
                <button type="submit" id="trackButton" class="btn-primary">
                    <i class="fa fa-search"></i> Ù¾ÛŒÚ¯ÛŒØ±ÛŒ
                </button>
            </form>
            
            <div id="trackingResults" class="tracking-results" style="display: none;">
                </div>
        </div>

        <footer class="footer">
            <p>ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ø¨Ø±Ø§ÛŒ <a href="https://shammay.ir" target="_blank" style="color: var(--primary-color); text-decoration: none;">Ay Technic</a> Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª. &copy; Û±Û´Û°Û³</p>
        </footer>

    </div>

    <script>
        const APP_URL = window.location.origin; // Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆØ± Ø´Ù…Ø§
        
        // --- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ù„Ù†â€ŒÙ‡Ø§ ---
        // Ù…Ø¨Ù„Øº Ø¨Ù‡ Ø±ÛŒØ§Ù„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª ØªØ§ Ù‡Ù†Ú¯Ø§Ù… Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„ Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ø¶Ø±Ø¨ Ø¯Ø± Û±Û° Ù†Ø¨Ø§Ø´Ø¯.
        const plansData = [
            { duration: 'Û± Ù…Ø§Ù‡Ù‡', baseAmount: 1200000, durationDays: 30, type: 'unlimited', icon: 'ğŸ’', requestedPlan: '1M', basePriceToman: 120000 },
            { duration: 'Û² Ù…Ø§Ù‡Ù‡', baseAmount: 2200000, durationDays: 60, type: 'unlimited', icon: 'ğŸš€', requestedPlan: '2M', basePriceToman: 220000 },
            { duration: 'Û³ Ù…Ø§Ù‡Ù‡', baseAmount: 3400000, durationDays: 90, type: 'unlimited', icon: 'ğŸŒŸ', requestedPlan: '3M', basePriceToman: 340000 },
            { duration: 'Û¶ Ù…Ø§Ù‡Ù‡', baseAmount: 6000000, durationDays: 180, type: 'unlimited', icon: 'ğŸ”¥', requestedPlan: '6M', basePriceToman: 600000 },
            { duration: 'Û± Ø³Ø§Ù„Ù‡', baseAmount: 10000000, durationDays: 365, type: 'unlimited', icon: 'ğŸ‘‘', requestedPlan: '1Y', basePriceToman: 1000000 },
            { duration: 'Û² Ø³Ø§Ù„Ù‡', baseAmount: 20000000, durationDays: 730, type: 'unlimited', icon: 'â­', requestedPlan: '2Y', basePriceToman: 2000000 },
        ];
        
        let selectedPlan = null; // Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø¬Ø¯ÛŒØ¯
        let selectedRenewPlan = null; // Ø¨Ø±Ø§ÛŒ ØªÙ…Ø¯ÛŒØ¯
        
        // --- ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ---

        // ØªØ§Ø¨Ø¹ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ú†Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø±Ù‡ (Ù…Ø¨Ù„Øº Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±ÛŒØ§Ù„ Ø§Ø³Øª)
        const calculateMultiUserPrice = (basePrice, users) => {
            // Price = Base Price + (Users - 1) * 50% of Base Price
            const multiplier = 1 + (users - 1) * 0.5;
            // Ú¯Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù†Ø²Ø¯ÛŒÚ©ØªØ±ÛŒÙ† Û±Û°Û°Û° ØªÙˆÙ…Ø§Ù† (Û±Û°,Û°Û°Û° Ø±ÛŒØ§Ù„)
            return Math.round(basePrice * multiplier / 10000) * 10000; 
        };
        
        // ØªØ§Ø¨Ø¹ ÙØ±Ù…Øª Ù…Ø¨Ù„Øº
        const formatToman = (amount) => (amount / 10).toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†';
        
        // --- Ù…Ø¯ÛŒØ±ÛŒØª ØªØ¨â€ŒÙ‡Ø§ ---
        function openTab(evt, tabName) {
            let i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
            
            // Ø§Ú¯Ø± Ø¨Ù‡ ØªØ¨ Ø®Ø±ÛŒØ¯ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±ÙˆÛŒÙ…ØŒ Ù¾Ù„Ù† ØªÙ…Ø¯ÛŒØ¯ Ø±Ø§ Ø±ÛŒØ³Øª Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
            if (tabName === 'buy-tab') {
                 selectedRenewPlan = null;
                 document.getElementById('dynamic-section-renew').style.display = 'none';
                 document.getElementById('renewal-form').reset();
                 document.querySelectorAll('.plan-selection-renew .plan-card').forEach(card => card.classList.remove('selected'));
            }
            
            // Ø§Ú¯Ø± Ø¨Ù‡ ØªØ¨ ØªÙ…Ø¯ÛŒØ¯ Ø¨Ø±ÙˆÛŒÙ…ØŒ Ù¾Ù„Ù† Ø®Ø±ÛŒØ¯ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø±ÛŒØ³Øª Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
            if (tabName === 'renew-tab') {
                 selectedPlan = null;
                 document.getElementById('dynamic-section').style.display = 'none';
                 document.getElementById('purchase-form').reset();
                 document.querySelectorAll('.plan-cards .plan-card').forEach(card => card.classList.remove('selected'));
            }
            
            // Ø§Ú¯Ø± Ø¨Ù‡ ØªØ¨ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø¨Ø±ÙˆÛŒÙ…ØŒ ÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ø±Ø§ Ø±ÛŒØ³Øª Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
            if (tabName === 'track-tab') {
                document.getElementById('trackingResults').style.display = 'none';
                document.getElementById('tracking-form').reset();
            }
            
             // Ù…Ø·Ù…Ø¦Ù† Ù…ÛŒâ€ŒØ´ÙˆÛŒÙ… Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ Ø±Ù†Ø¯Ø± Ø´ÙˆÙ†Ø¯
            lucide.createIcons();
        }

        // --- ØªÙˆØ§Ø¨Ø¹ Ø®Ø±ÛŒØ¯ Ø¬Ø¯ÛŒØ¯ ---
        function selectPlan(card) {
            document.querySelectorAll('.plan-cards .plan-card').forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');

            const planCode = card.getAttribute('data-plan-code');
            selectedPlan = plansData.find(p => p.requestedPlan === planCode);
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© (Ú©Ø§Ø±Ø¨Ø±/Ú©ÙˆÙ¾Ù†/Ø®Ù„Ø§ØµÙ‡)
            document.getElementById('dynamic-section').style.display = 'block';
            
            // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ú©ÙˆÙ¾Ù† Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®Ù„Ø§ØµÙ‡
            document.getElementById('coupenCode').value = '';
            document.getElementById('users').value = '1';
            clearCouponMessage();
            updateSummary();
        }

        function updateSummary() {
            if (!selectedPlan) return;
            
            const users = parseInt(document.getElementById('users').value);
            const baseAmount = selectedPlan.baseAmount;
            
            // Û±. Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¨Ù„Øº Ú†Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø±Ù‡
            const multiUserAmount = calculateMultiUserPrice(baseAmount, users); 
            
            // Û². Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®Ù„Ø§ØµÙ‡ Ø¨Ø§ Ù…Ø¨Ù„Øº Ú†Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø±Ù‡ (Ø±ÛŒØ§Ù„ÛŒ)
            const couponMessageEl = document.getElementById('couponMessage');
            const summaryFinalAmountEl = document.getElementById('summary-final-amount');
            const summaryDiscountRowEl = document.getElementById('summary-discount-row');
            const payButton = document.getElementById('payButton');

            // Ø±ÛŒØ³Øª Ú©ÙˆÙ¾Ù† Ùˆ Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ (ØªØ§ Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø´ÙˆØ¯)
            summaryFinalAmountEl.setAttribute('data-final-amount', multiUserAmount);
            summaryFinalAmountEl.textContent = formatToman(multiUserAmount);
            summaryDiscountRowEl.style.display = 'none';
            couponMessageEl.style.display = 'none';
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ø§ÛŒØ± Ù…ÙˆØ§Ø±Ø¯
            document.getElementById('summary-plan').textContent = selectedPlan.duration;
            document.getElementById('summary-users').textContent = users + ' Ú©Ø§Ø±Ø¨Ø±';
            document.getElementById('summary-base-amount').textContent = formatToman(baseAmount);

            payButton.disabled = false;
            payButton.innerHTML = `<i class="fa fa-shopping-cart"></i> Ø§Ø¯Ø§Ù…Ù‡ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª ${formatToman(multiUserAmount)}`;
        }
        
        function clearCouponMessage() {
            document.getElementById('couponMessage').style.display = 'none';
        }

        async function checkCoupon() {
            const coupenCode = document.getElementById('coupenCode').value.trim();
            const originalAmount = Number(document.getElementById('summary-final-amount').getAttribute('data-final-amount'));
            const requestedPlan = selectedPlan ? selectedPlan.requestedPlan : null;
            
            const couponMessageEl = document.getElementById('couponMessage');
            const summaryFinalAmountEl = document.getElementById('summary-final-amount');
            const summaryDiscountRowEl = document.getElementById('summary-discount-row');
            const summaryDiscountValueEl = document.getElementById('summary-discount-value');
            const payButton = document.getElementById('payButton');
            const checkCouponBtn = document.getElementById('checkCouponBtn');
            const originalBtnText = checkCouponBtn.textContent;
            
            // Ø§Ú¯Ø± Ú©ÙˆÙ¾Ù† Ø®Ø§Ù„ÛŒ Ø§Ø³ØªØŒ Ø±ÛŒØ³Øª Ùˆ Ø¨Ø§Ø²Ú¯Ø´Øª
            if (!coupenCode) {
                 updateSummary();
                 return;
            }

            if (!requestedPlan || originalAmount <= 0) {
                 couponMessageEl.className = 'coupon-message coupon-error';
                 couponMessageEl.textContent = 'Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ù¾Ù„Ù† Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.';
                 couponMessageEl.style.display = 'block';
                 return;
            }
            
            // --- Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ÙˆÙ¾Ù† ---
            checkCouponBtn.disabled = true;
            checkCouponBtn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...';
            couponMessageEl.style.display = 'none';
            
            try {
                const response = await fetch(`${APP_URL}/api/coupen-check`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        coupenCode: coupenCode,
                        requestedPlan: requestedPlan,
                        finalAmount: originalAmount // Ù…Ø¨Ù„Øº Ú†Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø±Ù‡ (Ø±ÛŒØ§Ù„ÛŒ)
                    }),
                });

                const result = await response.json();
                
                // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ Ù‚Ø¨Ù„ Ø§Ø² Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡
                updateSummary();

                if (result.success) {
                    const newAmount = result.newAmount;
                    const discountValue = result.discountValue;

                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI Ø¨Ø§ ØªØ®ÙÛŒÙ
                    couponMessageEl.className = 'coupon-message coupon-success';
                    couponMessageEl.textContent = result.message;
                    
                    summaryFinalAmountEl.setAttribute('data-final-amount', newAmount);
                    summaryFinalAmountEl.textContent = result.formattedNewAmount;
                    
                    summaryDiscountRowEl.style.display = 'flex';
                    summaryDiscountValueEl.textContent = '-' + result.formattedDiscountValue;

                    payButton.innerHTML = `<i class="fa fa-shopping-cart"></i> Ø§Ø¯Ø§Ù…Ù‡ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª ${result.formattedNewAmount}`;
                    
                } else {
                    // Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§ Ùˆ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ø¨Ù„Øº Ø§ØµÙ„ÛŒ
                    couponMessageEl.className = 'coupon-message coupon-error';
                    couponMessageEl.textContent = result.error || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ú©ÙˆÙ¾Ù†.';
                }
                
                couponMessageEl.style.display = 'block';

            } catch (error) {
                console.error('Coupon Check Error:', error);
                couponMessageEl.className = 'coupon-message coupon-error';
                couponMessageEl.textContent = 'Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³ Ú©ÙˆÙ¾Ù†.';
                couponMessageEl.style.display = 'block';
                updateSummary(); // Ø±ÛŒØ³Øª Ø¨Ù‡ Ù…Ø¨Ù„Øº Ø§ØµÙ„ÛŒ
            } finally {
                checkCouponBtn.disabled = false;
                checkCouponBtn.textContent = originalBtnText;
            }
        }

        document.getElementById('purchase-form').addEventListener('submit', handlePurchase);
        
        async function handlePurchase(event) {
            event.preventDefault();
            
            if (!selectedPlan) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ù¾Ù„Ù† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');
                return;
            }

            const payButton = document.getElementById('payButton');
            const originalText = payButton.innerHTML;
            
            payButton.disabled = true;
            payButton.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡...';

            const form = event.target;
            const finalAmount = Number(document.getElementById('summary-final-amount').getAttribute('data-final-amount'));
            
            const postData = {
                amount: finalAmount, // Ù…Ø¨Ù„Øº Ø±ÛŒØ§Ù„ÛŒ Ù†Ù‡Ø§ÛŒÛŒ
                description: `Ø®Ø±ÛŒØ¯ Ø§Ø² Ø·Ø±ÛŒÙ‚ ÙˆØ¨ - Ù¾Ù„Ù† ${selectedPlan.requestedPlan} (${form.users.value} Ú©Ø§Ø±Ø¨Ø±Ù‡)`,
                email: form.email.value,
                renewalIdentifier: form.renewalIdentifier.value || '',
                requestedPlan: selectedPlan.requestedPlan,
                coupenCode: form.coupenCode.value.trim() || '',
                users: form.users.value,
            };
            
            try {
                const response = await fetch(`${APP_URL}/api/start-payment`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData)
                });

                const result = await response.json();

                if (result.authority) {
                    const zarinpalUrl = `https://www.zarinpal.com/pg/StartPay/${result.authority}`;
                    window.location.href = zarinpalUrl;
                } else {
                    alert(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª: ${result.error || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡'}`);
                }

            } catch (error) {
                console.error('Payment Error:', error);
                alert('âŒ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ ÛŒØ§ Ø³Ø±ÙˆØ± Ø¯Ø± Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
            } finally {
                payButton.innerHTML = originalText;
                payButton.disabled = false;
            }
        }
        
        // --- ØªÙˆØ§Ø¨Ø¹ ØªÙ…Ø¯ÛŒØ¯ ---
        
        // Ù¾Ø± Ú©Ø±Ø¯Ù† Ø³Ú©ØªÙˆØ± ÛŒÙˆØ²Ø±Ù‡Ø§ÛŒ ØªÙ…Ø¯ÛŒØ¯
        document.getElementById('renew-users').innerHTML = document.getElementById('users').innerHTML;
        
        function selectRenewPlan(card) {
            document.querySelectorAll('.plan-selection-renew .plan-card').forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');

            const planCode = card.getAttribute('data-plan-code');
            selectedRenewPlan = plansData.find(p => p.requestedPlan === planCode);
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© ØªÙ…Ø¯ÛŒØ¯
            document.getElementById('dynamic-section-renew').style.display = 'block';
            
            // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ú©ÙˆÙ¾Ù† Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®Ù„Ø§ØµÙ‡
            document.getElementById('renew-coupenCode').value = '';
            document.getElementById('renew-users').value = '1';
            clearRenewCouponMessage();
            updateRenewSummary();
        }
        
        function updateRenewSummary() {
             if (!selectedRenewPlan) return;
            
            const users = parseInt(document.getElementById('renew-users').value);
            const baseAmount = selectedRenewPlan.baseAmount;
            
            // Û±. Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¨Ù„Øº Ú†Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø±Ù‡
            const multiUserAmount = calculateMultiUserPrice(baseAmount, users); 
            
            // Û². Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®Ù„Ø§ØµÙ‡ Ø¨Ø§ Ù…Ø¨Ù„Øº Ú†Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø±Ù‡ (Ø±ÛŒØ§Ù„ÛŒ)
            const couponMessageEl = document.getElementById('renewCouponMessage');
            const summaryFinalAmountEl = document.getElementById('renew-summary-final-amount');
            const summaryDiscountRowEl = document.getElementById('renew-summary-discount-row');
            const payButton = document.getElementById('renewPayButton');

            // Ø±ÛŒØ³Øª Ú©ÙˆÙ¾Ù† Ùˆ Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ (ØªØ§ Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø´ÙˆØ¯)
            summaryFinalAmountEl.setAttribute('data-final-amount', multiUserAmount);
            summaryFinalAmountEl.textContent = formatToman(multiUserAmount);
            summaryDiscountRowEl.style.display = 'none';
            couponMessageEl.style.display = 'none';
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ø§ÛŒØ± Ù…ÙˆØ§Ø±Ø¯
            document.getElementById('renew-summary-plan').textContent = selectedRenewPlan.duration;
            document.getElementById('renew-summary-users').textContent = users + ' Ú©Ø§Ø±Ø¨Ø±';
            document.getElementById('renew-summary-base-amount').textContent = formatToman(baseAmount);

            payButton.disabled = false;
            payButton.innerHTML = `<i class="fa fa-shopping-cart"></i> Ø§Ø¯Ø§Ù…Ù‡ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª ${formatToman(multiUserAmount)}`;
        }
        
        function clearRenewCouponMessage() {
             document.getElementById('renewCouponMessage').style.display = 'none';
        }
        
        async function checkRenewCoupon() {
             const coupenCode = document.getElementById('renew-coupenCode').value.trim();
            const originalAmount = Number(document.getElementById('renew-summary-final-amount').getAttribute('data-final-amount'));
            const requestedPlan = selectedRenewPlan ? selectedRenewPlan.requestedPlan : null;
            
            const couponMessageEl = document.getElementById('renewCouponMessage');
            const summaryFinalAmountEl = document.getElementById('renew-summary-final-amount');
            const summaryDiscountRowEl = document.getElementById('renew-summary-discount-row');
            const summaryDiscountValueEl = document.getElementById('renew-summary-discount-value');
            const payButton = document.getElementById('renewPayButton');
            const checkCouponBtn = document.getElementById('checkRenewCouponBtn');
            const originalBtnText = checkCouponBtn.textContent;
            
            if (!coupenCode) {
                 updateRenewSummary();
                 return;
            }

            if (!requestedPlan || originalAmount <= 0) {
                 couponMessageEl.className = 'coupon-message coupon-error';
                 couponMessageEl.textContent = 'Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ù¾Ù„Ù† ØªÙ…Ø¯ÛŒØ¯ Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.';
                 couponMessageEl.style.display = 'block';
                 return;
            }
            
            // --- Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©ÙˆÙ¾Ù† ---
            checkCouponBtn.disabled = true;
            checkCouponBtn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...';
            couponMessageEl.style.display = 'none';
            
            try {
                const response = await fetch(`${APP_URL}/api/coupen-check`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        coupenCode: coupenCode,
                        requestedPlan: requestedPlan,
                        finalAmount: originalAmount // Ù…Ø¨Ù„Øº Ú†Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø±Ù‡ (Ø±ÛŒØ§Ù„ÛŒ)
                    }),
                });

                const result = await response.json();
                
                // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ Ù‚Ø¨Ù„ Ø§Ø² Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡
                updateRenewSummary();

                if (result.success) {
                    const newAmount = result.newAmount;
                    const discountValue = result.discountValue;

                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI Ø¨Ø§ ØªØ®ÙÛŒÙ
                    couponMessageEl.className = 'coupon-message coupon-success';
                    couponMessageEl.textContent = result.message;
                    
                    summaryFinalAmountEl.setAttribute('data-final-amount', newAmount);
                    summaryFinalAmountEl.textContent = result.formattedNewAmount;
                    
                    summaryDiscountRowEl.style.display = 'flex';
                    summaryDiscountValueEl.textContent = '-' + result.formattedDiscountValue;

                    payButton.innerHTML = `<i class="fa fa-shopping-cart"></i> Ø§Ø¯Ø§Ù…Ù‡ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª ${result.formattedNewAmount}`;
                    
                } else {
                    // Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§ Ùˆ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ø¨Ù„Øº Ø§ØµÙ„ÛŒ
                    couponMessageEl.className = 'coupon-message coupon-error';
                    couponMessageEl.textContent = result.error || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ú©ÙˆÙ¾Ù†.';
                }
                
                couponMessageEl.style.display = 'block';

            } catch (error) {
                console.error('Renew Coupon Check Error:', error);
                couponMessageEl.className = 'coupon-message coupon-error';
                couponMessageEl.textContent = 'Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³ Ú©ÙˆÙ¾Ù†.';
                couponMessageEl.style.display = 'block';
                updateRenewSummary(); // Ø±ÛŒØ³Øª Ø¨Ù‡ Ù…Ø¨Ù„Øº Ø§ØµÙ„ÛŒ
            } finally {
                checkCouponBtn.disabled = false;
                checkCouponBtn.textContent = originalBtnText;
            }
        }
        
        document.getElementById('renewal-form').addEventListener('submit', handleRenewal);

        async function handleRenewal(event) {
            event.preventDefault();
            
            if (!selectedRenewPlan) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ù¾Ù„Ù† Ø¨Ø±Ø§ÛŒ ØªÙ…Ø¯ÛŒØ¯ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');
                return;
            }

            const payButton = document.getElementById('renewPayButton');
            const originalText = payButton.innerHTML;
            
            payButton.disabled = true;
            payButton.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡...';

            const form = event.target;
            const finalAmount = Number(document.getElementById('renew-summary-final-amount').getAttribute('data-final-amount'));
            
            const postData = {
                amount: finalAmount, // Ù…Ø¨Ù„Øº Ø±ÛŒØ§Ù„ÛŒ Ù†Ù‡Ø§ÛŒÛŒ
                description: `ØªÙ…Ø¯ÛŒØ¯ Ø§Ø² Ø·Ø±ÛŒÙ‚ ÙˆØ¨ - Ù¾Ù„Ù† ${selectedRenewPlan.requestedPlan} (${form['users'].value} Ú©Ø§Ø±Ø¨Ø±Ù‡)`,
                renewalIdentifier: form.renewId.value, // Ø´Ù†Ø§Ø³Ù‡/Ø§ÛŒÙ…ÛŒÙ„/Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ù‚Ø¨Ù„ÛŒ
                requestedPlan: selectedRenewPlan.requestedPlan,
                coupenCode: form['coupenCode'].value.trim() || '',
                users: form['users'].value,
                // Ø¨Ø±Ø§ÛŒ ØªÙ…Ø¯ÛŒØ¯ØŒ Ø§ÛŒÙ…ÛŒÙ„ Ø±Ø§ Ø®Ø§Ù„ÛŒ Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±ÛŒÙ… ÛŒØ§ Ø§Ø² renewId Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø§Ú¯Ø± Ø§ÛŒÙ…ÛŒÙ„ Ø¨Ø§Ø´Ø¯.
                email: form.renewId.value.includes('@') ? form.renewId.value : '' 
            };
            
            try {
                const response = await fetch(`${APP_URL}/api/start-payment`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData)
                });

                const result = await response.json();

                if (result.authority) {
                    const zarinpalUrl = `https://www.zarinpal.com/pg/StartPay/${result.authority}`;
                    window.location.href = zarinpalUrl;
                } else {
                    alert(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª: ${result.error || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡'}`);
                }

            } catch (error) {
                console.error('Renewal Payment Error:', error);
                alert('âŒ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ ÛŒØ§ Ø³Ø±ÙˆØ± Ø¯Ø± Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
            } finally {
                payButton.innerHTML = originalText;
                payButton.disabled = false;
            }
        }


        // --- ØªÙˆØ§Ø¨Ø¹ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´ (Ø­Ø°Ù Mockup) ---
        document.getElementById('tracking-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            
            const trackingId = document.getElementById('trackingId').value.trim();
            const trackingResults = document.getElementById('trackingResults');
            const trackButton = document.getElementById('trackButton');
            const originalText = trackButton.innerHTML;
            
            if (!trackingId) return;

            trackButton.disabled = true;
            trackButton.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ...';
            trackingResults.style.display = 'none';
            trackingResults.innerHTML = '';
            
            try {
                // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ API ÙˆØ§Ù‚Ø¹ÛŒ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ
                const response = await fetch(`${APP_URL}/api/track?trackingId=${trackingId}`);
                const result = await response.json();
                
                trackButton.innerHTML = originalText;
                trackButton.disabled = false;
                
                if (!response.ok || result.error) {
                    trackingResults.className = 'coupon-error tracking-results';
                    trackingResults.innerHTML = `<p>âŒ Ø³ÙØ§Ø±Ø´ÛŒ Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡ **${trackingId}** ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>`;
                } else {
                    let html = '<h3>âœ… Ø³ÙØ§Ø±Ø´Ø§Øª ÛŒØ§ÙØª Ø´Ø¯Ù‡:</h3>';
                    
                    result.forEach(item => {
                        // ØªØ¨Ø¯ÛŒÙ„ Ú©Ø¯ Ù¾Ù„Ù† Ø¨Ù‡ Ù†Ø§Ù… Ù‚Ø§Ø¨Ù„ Ø®ÙˆØ§Ù†Ø¯Ù†
                        const planName = item.plan.endsWith('D') ? `${parseInt(item.plan)} Ø±ÙˆØ²Ù‡` : (item.plan === 'Renew' ? 'ØªÙ…Ø¯ÛŒØ¯' : item.plan);
                        
                        html += `<div class="result-item">
                            <p><strong>Ù¾Ù„Ù†:</strong> ${planName}</p>
                            <p><strong>ØªØ§Ø±ÛŒØ® Ø®Ø±ÛŒØ¯:</strong> ${item.date}</p>
                            <p><strong>Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú©:</strong> <a href="${item.link}" target="_blank">Ù„ÛŒÙ†Ú© Ø¯Ø³ØªØ±Ø³ÛŒ</a></p>
                            <p><strong>ÙˆØ¶Ø¹ÛŒØª:</strong> <span style="color: var(--success-color);">Ù…ÙˆÙÙ‚</span></p>
                        </div>`;
                    });
                    trackingResults.className = 'coupon-success tracking-results';
                    trackingResults.innerHTML = html;
                }
                
                trackingResults.style.display = 'block';

            } catch (error) {
                console.error('Tracking fetch error:', error);
                trackButton.innerHTML = originalText;
                trackButton.disabled = false;
                trackingResults.className = 'coupon-error tracking-results';
                trackingResults.innerHTML = '<p>âŒ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ ÛŒØ§ Ø³Ø±ÙˆØ± Ø¯Ø± Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´.</p>';
                trackingResults.style.display = 'block';
            }
        });


        // Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡: Ø§Ù†ØªØ®Ø§Ø¨ ØªØ¨ Ø®Ø±ÛŒØ¯ Ùˆ Ø±Ù†Ø¯Ø± Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector('.tab-button').click(); // Show default tab
            lucide.createIcons();
            
            // Ø±Ù†Ø¯Ø± Ú©Ø±Ø¯Ù† Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ÛŒ lucide Ø¯Ø± Ù¾Ù„Ù† Ú©Ø§Ø±Ø¯Ù‡Ø§ (Ú©Ù‡ Ø¯Ø± Ø§Ø³ØªØ§ÛŒÙ„ Ù¾Ù†Ù‡Ø§Ù† Ø¨ÙˆØ¯Ù†Ø¯)
            document.querySelectorAll('.plan-card .feature-list li svg').forEach(icon => {
                icon.setAttribute('width', '20');
                icon.setAttribute('height', '20');
            });
        });
    </script>

</body>
</html>